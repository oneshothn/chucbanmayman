<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vòng Quay May Mắn</title>
<style>
    body {background:#111;color:#fff;font-family:Arial;text-align:center;margin:0;padding:10px;}
    h1 {font-size:1.5rem;}
    .container {position:relative;max-width:350px;margin:auto;}
    canvas {width:100%;border-radius:50%;background:#fff;box-shadow:0 0 15px rgba(255,255,255,0.3);}
    .arrow {position:absolute;bottom:-20px;left:50%;transform:translateX(-50%) rotate(180deg);
        width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;
        border-top:25px solid red;}
    button {
        margin-top:50px; /* ✅ tăng khoảng cách để nút cách xa mũi tên */
        padding:12px 24px;
        background:#28a745;
        color:#fff;
        border:none;
        border-radius:8px;
        font-size:1rem;
    }
    button:disabled{background:gray;}
    .popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);
        justify-content:center;align-items:center;}
    .popup-content{background:#fff;color:#111;padding:20px;border-radius:10px;text-align:center;max-width:300px;}
    .popup-content h2{margin:10px 0;
        font-family:"Times New Roman", serif; /* ✅ đổi font cho phần thông báo */
        font-size:20px;}
</style>
</head>
<body>
<h1>🎯 Vòng Quay May Mắn 🎯</h1>
<div class="container">
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <div class="arrow"></div>
</div>
<button id="spinBtn">Quay ngay</button>
<div class="popup" id="popup">
    <div class="popup-content">
        <h2 id="popup-text"></h2>
        <button onclick="closePopup()">OK</button>
    </div>
</div>
<script>
const canvas=document.getElementById("wheelCanvas"),ctx=canvas.getContext("2d");
const spinBtn=document.getElementById("spinBtn"),popup=document.getElementById("popup"),popupText=document.getElementById("popup-text");

const prizes=["Giảm 5%","Giảm 10%","Giảm 15%","Giảm 20%","Giảm 50%","Giảm 25%"];
const colors=["#f39c12","#e74c3c","#2980b9","#27ae60","#8e44ad","#f1c40f"];
const weights=[25,23,20,10,2,20];

const totalSegments=prizes.length;
const segmentAngle=360/totalSegments;
const arcSize=(2*Math.PI)/totalSegments;
let rotation=0,spinning=false;

// Giới hạn 1 lần quay
if(localStorage.getItem("spun")==="true"){
    spinBtn.disabled=true;
    spinBtn.textContent="Bạn đã quay rồi!";
}

// Vẽ vòng quay
function drawWheel(){
    for(let i=0;i<totalSegments;i++){
        const angle=i*arcSize;
        ctx.beginPath();
        ctx.moveTo(200,200);
        ctx.arc(200,200,180,angle,angle+arcSize);
        ctx.fillStyle=colors[i];
        ctx.fill();
        ctx.save();
        ctx.translate(200,200);
        ctx.rotate(angle+arcSize/2);
        ctx.fillStyle="#fff";
        ctx.font="bold 18px Arial";
        ctx.textAlign="right";
        ctx.fillText(prizes[i],160,10);
        ctx.restore();
    }
}

// Chọn góc theo trọng số
function getWeightedAngle(){
    let total=weights.reduce((a,b)=>a+b,0);
    let r=Math.random()*total;
    for(let i=0;i<weights.length;i++){
        if(r<weights[i]){
            return (i*segmentAngle)+Math.random()*segmentAngle;
        }
        r-=weights[i];
    }
    return 0;
}

function spinWheel(){
    if(spinning)return;
    spinning=true;

    const targetAngle=getWeightedAngle();
    const stopAngle=360*5+targetAngle; // quay 5 vòng + góc chọn
    const duration=4000;
    const start=performance.now();

    function animate(time){
        const elapsed=time-start;
        const progress=Math.min(elapsed/duration,1);
        rotation=stopAngle*progress;

        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.save();
        ctx.translate(200,200);
        ctx.rotate(rotation*Math.PI/180);
        ctx.translate(-200,-200);
        drawWheel();
        ctx.restore();

        if(progress<1){
            requestAnimationFrame(animate);
        }else{
            spinning=false;
            const finalAngle=(stopAngle%360);
            const adjustedAngle = (360 - finalAngle + 90) % 360; // mũi tên ở dưới
            const chosenIndex = Math.floor(adjustedAngle / segmentAngle);
            showResult(chosenIndex);
            localStorage.setItem("spun","true"); // Lưu trạng thái đã quay
            spinBtn.disabled=true;
            spinBtn.textContent="Bạn đã quay rồi!";
        }
    }
    requestAnimationFrame(animate);
}

function showResult(index){
    popupText.innerHTML=`🎉 Bạn nhận được: <strong>${prizes[index]}</strong> 🎉`;
    popup.style.display="flex";
}

function closePopup(){popup.style.display="none";}
drawWheel();
spinBtn.addEventListener("click",spinWheel);
</script>
</body>
</html>

